<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤©åƒä»€éº¼ï¼Ÿ(æŠ•å¹£æ‹‰éœ¸ç‰ˆ)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Righteous&family=Noto+Sans+TC:wght@500;900&display=swap');

        /* --- å…¨å±€èˆ‡èƒŒæ™¯ --- */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #222;
            /* è³­å ´åœ°æ¯¯é¢¨æ ¼ */
            background-image: radial-gradient(#444 15%, transparent 16%), radial-gradient(#444 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none; /* é˜²æ­¢æ‹–æ›³æ™‚é¸å–åˆ°æ–‡å­— */
        }

        /* --- éŒ¢åŒ…å€ (åº•éƒ¨) --- */
        .wallet-area {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.9);
            padding: 15px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-top: 3px solid #f57f17;
            z-index: 100;
            overflow-x: auto;
        }

        .money {
            cursor: grab;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Righteous', sans-serif;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        }
        .money:hover { transform: translateY(-5px) scale(1.1); }
        .money:active { cursor: grabbing; }

        /* ç¡¬å¹£æ¨£å¼ */
        .coin { border-radius: 50%; border: 2px dashed rgba(255,255,255,0.4); }
        .coin-10 { width: 40px; height: 40px; background: #c0c0c0; color: #333; border: 2px solid #a0a0a0; }
        .coin-50 { width: 50px; height: 50px; background: #ffd700; color: #8a6d3b; border: 2px solid #d4af37; }

        /* éˆ”ç¥¨æ¨£å¼ */
        .bill { width: 80px; height: 40px; border-radius: 4px; color: white; font-size: 0.9rem; text-shadow: 1px 1px 0 rgba(0,0,0,0.5); }
        .bill-100 { background: #d32f2f; border: 1px solid #ff8a80; }
        .bill-500 { background: #795548; border: 1px solid #d7ccc8; }
        .bill-1000 { background: #1976d2; border: 1px solid #90caf9; }

        /* --- æ‹‰éœ¸æ©Ÿæœ¬é«” --- */
        .slot-machine {
            width: 90%;
            max-width: 500px;
            background: #b71c1c;
            border-radius: 30px;
            padding: 20px;
            box-shadow: 
                0 0 0 8px #5c0000,
                0 20px 50px rgba(0,0,0,0.8);
            position: relative;
            border: 4px solid #ffd700;
            margin-top: 20px;
            margin-bottom: 120px; /* ç•™çµ¦éŒ¢åŒ… */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* æŠ•å¹£å­”å€åŸŸ (å³å´) */
        .coin-slot-area {
            position: absolute;
            right: -15px;
            top: 150px;
            width: 60px;
            height: 100px;
            background: #333;
            border: 4px solid #888;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }

        .coin-slot-hole {
            width: 10px;
            height: 40px;
            background: #000;
            border-radius: 5px;
            box-shadow: inset 0 0 5px #fff;
            margin-bottom: 5px;
        }
        
        .slot-label { font-size: 0.6rem; color: #aaa; text-align: center; }

        /* æ‹–æ›³ç¶“éæ™‚çš„ç‰¹æ•ˆ */
        .drag-over {
            background: #4caf50;
            transform: scale(1.1);
            border-color: #fff;
        }

        /* é¡¯ç¤ºé‡‘é¡é¢æ¿ */
        .budget-display {
            background: #000;
            color: #0f0;
            font-family: 'Righteous', monospace;
            font-size: 1.5rem;
            padding: 10px 20px;
            border: 3px solid #555;
            border-radius: 5px;
            margin-bottom: 15px;
            width: 80%;
            text-align: center;
            box-shadow: inset 0 0 10px rgba(0,255,0,0.2);
            position: relative;
        }
        
        .clear-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 0.7rem;
            cursor: pointer;
            padding: 2px 5px;
        }

        /* è¦–çª—èˆ‡æ»¾å‹•æ¢ */
        .window-frame {
            width: 100%;
            background: #000;
            padding: 10px;
            border-radius: 10px;
            border: 4px solid #f57f17;
            box-shadow: inset 0 0 20px #000;
            margin-bottom: 20px;
            position: relative;
            box-sizing: border-box;
        }
        .window-frame::after { /* ç»ç’ƒåå…‰ */
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.15), transparent);
            pointer-events: none; z-index: 5;
        }

        .reel-container {
            height: 120px; /* è¦–çª—é«˜åº¦ */
            overflow: hidden;
            position: relative;
            background: #fff;
            border-radius: 5px;
        }

        .reel-strip {
            position: absolute;
            width: 100%;
            transform: translateY(0);
        }

        /* æ»¾å‹•å‹•ç•« Class */
        .spin-animation {
            /* 3ç§’ï¼Œè²èŒ²æ›²ç·šåšå‡ºåƒçœŸå¯¦è½‰è¼ªä¸€æ¨£å…ˆå¿«å¾Œæ…¢çš„æ•ˆæœ */
            transition: transform 3s cubic-bezier(0.1, 0.9, 0.2, 1);
            filter: blur(1px);
        }

        .slot-item {
            height: 120px; /* å¿…é ˆç­‰æ–¼è¦–çª—é«˜åº¦ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: #333;
            border-bottom: 1px solid #ddd;
            background-color: #fafafa;
            padding: 0 10px;
            text-align: center;
        }
        .slot-item:nth-child(even) { background-color: #f0f0f0; }

        /* æ§åˆ¶é¢æ¿ (å£å‘³/æº«åº¦) */
        .control-panel {
            width: 100%;
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .toggle-group {
            flex: 1;
            background: #444;
            padding: 5px;
            border-radius: 8px;
            display: flex;
        }
        .toggle-btn {
            flex: 1;
            padding: 8px 0;
            text-align: center;
            cursor: pointer;
            color: #aaa;
            border-radius: 5px;
            transition: 0.2s;
            font-size: 0.9rem;
        }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + .toggle-btn {
            background: #ffd700;
            color: #000;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* æ‹‰éœ¸æŒ‰éˆ• */
        #spinBtn {
            width: 100%;
            padding: 18px;
            font-size: 1.8rem;
            font-family: 'Righteous', cursive;
            color: white;
            background: linear-gradient(to bottom, #ff5252, #b71c1c);
            border: none;
            border-radius: 50px;
            border-bottom: 8px solid #7f0000;
            cursor: pointer;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: transform 0.1s, border 0.1s;
        }
        #spinBtn:active {
            transform: translateY(6px);
            border-bottom-width: 2px;
            box-shadow: none;
        }
        #spinBtn:disabled {
            background: #555;
            border-bottom-color: #333;
            cursor: not-allowed;
            color: #999;
        }

        /* æ¨™é¡Œ */
        h1 { margin: 0 0 20px 0; color: #ffd700; text-shadow: 2px 2px 0 #000; }

        /* çµæœæŒ‰éˆ• */
        #actionArea {
            margin-top: 15px;
            display: none;
            width: 100%;
            gap: 10px;
        }
        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
        }
        .map-btn { background: #1e88e5; color: white; }
        .retry-btn { background: #616161; color: white; }

        /* æç¤ºè¨Šæ¯ */
        .msg { color: #ffeb3b; font-size: 0.8rem; margin-top: 5px; height: 1.2em; }

    </style>
</head>
<body>

    <div class="slot-machine">
        <h1>FOOD SLOT</h1>

        <div class="budget-display">
            NT$ <span id="budgetDisplay">0</span>
            <button class="clear-btn" id="returnCoinBtn">é€€å¹£</button>
        </div>

        <div class="window-frame">
            <div class="reel-container">
                <div id="reelStrip" class="reel-strip">
                    <div class="slot-item">è«‹å…ˆæŠ•å¹£</div>
                </div>
            </div>
        </div>

        <div class="coin-slot-area" id="coinSlot">
            <div class="coin-slot-hole"></div>
            <div class="slot-label">INSERT<br>COIN</div>
        </div>

        <div class="control-panel">
            <div class="toggle-group">
                <input type="radio" id="savory" name="flavor" value="é¹¹" checked>
                <label for="savory" class="toggle-btn">ğŸœ é¹¹é£Ÿ</label>
                <input type="radio" id="sweet" name="flavor" value="ç”œ">
                <label for="sweet" class="toggle-btn">ğŸ° ç”œé»</label>
            </div>
            <div class="toggle-group" style="margin-left: 10px;">
                <input type="radio" id="hot" name="temp" value="ç†±" checked>
                <label for="hot" class="toggle-btn">ğŸ”¥ ç†±</label>
                <input type="radio" id="cold" name="temp" value="å†·">
                <label for="cold" class="toggle-btn">â„ï¸ å†·</label>
            </div>
        </div>
        
        <div class="msg" id="msgBox">è«‹æ‹–æ›³ä¸‹æ–¹é‡‘å¹£æŠ•å…¥æ©Ÿå°</div>

        <button id="spinBtn">ğŸ° SPIN</button>

        <div id="actionArea">
            <a id="mapLink" href="#" target="_blank" class="action-btn map-btn">ğŸ“ Google Map</a>
            <button id="retryBtn" class="action-btn retry-btn">å†è½‰ä¸€æ¬¡</button>
        </div>
    </div>

    <div class="wallet-area">
        <div class="money coin coin-10" draggable="true" data-value="10">$10</div>
        <div class="money coin coin-50" draggable="true" data-value="50">$50</div>
        <div class="money bill bill-100" draggable="true" data-value="100">$100</div>
        <div class="money bill bill-500" draggable="true" data-value="500">$500</div>
        <div class="money bill bill-1000" draggable="true" data-value="1000">$1000</div>
    </div>

    <script>
        // --- 1. é£Ÿç‰©è³‡æ–™åº« (å«ç´„ç•¥åƒ¹æ ¼) ---
        // åƒ¹æ ¼è¨­å®šï¼š
        // 1 = 150ä»¥ä¸‹
        // 2 = 500ä»¥ä¸‹
        // 3 = 1500ä»¥ä¸‹
        // 4 = 1500ä»¥ä¸Š
        const foodDatabase = [
            // é¹¹ + ç†±
            { name: "æ»·è‚‰é£¯", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "è²¢ä¸¸æ¹¯", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "æ°´é¤ƒ", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "é‹è²¼", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "èšµä»”éºµç·š", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "è‚‰åœ“", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "ç”œä¸è¾£", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "è›‹é¤…", price: 1, flavor: "é¹¹", temp: "ç†±" },
            { name: "ç‰›è‚‰éºµ", price: 2, flavor: "é¹¹", temp: "ç†±" },
            { name: "å°ç«é‹", price: 2, flavor: "é¹¹", temp: "ç†±" },
            { name: "æ‹‰éºµ", price: 2, flavor: "é¹¹", temp: "ç†±" },
            { name: "éŸ“å¼ç‚¸é›", price: 3, flavor: "é¹¹", temp: "ç†±" },
            { name: "éµæ¿ç‡’", price: 3, flavor: "é¹¹", temp: "ç†±" },
            { name: "ç‹å“ç‰›æ’", price: 4, flavor: "é¹¹", temp: "ç†±" },
            { name: "éº»è¾£é‹åƒåˆ°é£½", price: 4, flavor: "é¹¹", temp: "ç†±" },

            // é¹¹ + å†·
            { name: "æ¶¼éºµ", price: 1, flavor: "é¹¹", temp: "å†·" },
            { name: "å¾¡é£¯ç³°", price: 1, flavor: "é¹¹", temp: "å†·" },
            { name: "çš®è›‹è±†è…", price: 1, flavor: "é¹¹", temp: "å†·" },
            { name: "SUBWAY", price: 2, flavor: "é¹¹", temp: "å†·" },
            { name: "æ²™æ‹‰", price: 2, flavor: "é¹¹", temp: "å†·" },
            { name: "ç”Ÿæ˜¥æ²", price: 2, flavor: "é¹¹", temp: "å†·" },
            { name: "å£½å¸æ‹¼ç›¤", price: 3, flavor: "é¹¹", temp: "å†·" },
            { name: "ç”Ÿé­šç‰‡ä¸¼", price: 3, flavor: "é¹¹", temp: "å†·" },
            { name: "Omakase", price: 4, flavor: "é¹¹", temp: "å†·" },

            // ç”œ + ç†±
            { name: "ç´…è±†é¤…", price: 1, flavor: "ç”œ", temp: "ç†±" },
            { name: "é›è›‹ç³•", price: 1, flavor: "ç”œ", temp: "ç†±" },
            { name: "ç‡’ä»™è‰", price: 1, flavor: "ç”œ", temp: "ç†±" },
            { name: "ç†±è±†èŠ±", price: 1, flavor: "ç”œ", temp: "ç†±" },
            { name: "ç†±å¯å¯", price: 2, flavor: "ç”œ", temp: "ç†±" },
            { name: "èˆ’èŠ™è•¾", price: 3, flavor: "ç”œ", temp: "ç†±" },

            // ç”œ + å†·
            { name: "æ‰‹æ–é£²", price: 1, flavor: "ç”œ", temp: "å†·" },
            { name: "å†°è±†èŠ±", price: 1, flavor: "ç”œ", temp: "å†·" },
            { name: "æ„›ç‰å†°", price: 1, flavor: "ç”œ", temp: "å†·" },
            { name: "éœœæ·‡æ·‹", price: 1, flavor: "ç”œ", temp: "å†·" },
            { name: "å‰‰å†°", price: 2, flavor: "ç”œ", temp: "å†·" },
            { name: "åˆ‡ç‰‡è›‹ç³•", price: 2, flavor: "ç”œ", temp: "å†·" },
            { name: "å“ˆæ ¹é”æ–¯", price: 3, flavor: "ç”œ", temp: "å†·" },
            { name: "é£¯åº—ä¸‹åˆèŒ¶", price: 4, flavor: "ç”œ", temp: "å†·" }
        ];

        // --- 2. è®Šæ•¸ ---
        let currentBudget = 0;
        const budgetDisplay = document.getElementById('budgetDisplay');
        const coinSlot = document.getElementById('coinSlot');
        const msgBox = document.getElementById('msgBox');
        const spinBtn = document.getElementById('spinBtn');
        const reelStrip = document.getElementById('reelStrip');
        const actionArea = document.getElementById('actionArea');
        const mapLink = document.getElementById('mapLink');
        const ITEM_HEIGHT = 120; // å°æ‡‰ CSS é«˜åº¦

        // --- 3. æ‹–æ›³èˆ‡æŠ•å¹£é‚è¼¯ (Drag & Drop) ---
        const moneyItems = document.querySelectorAll('.money');

        moneyItems.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                // å‚³éé‡‘é¡æ•¸å€¼
                e.dataTransfer.setData('amount', item.getAttribute('data-value'));
            });
        });

        // å…è¨±æ”¾ç½®
        coinSlot.addEventListener('dragover', (e) => {
            e.preventDefault(); // å¿…é ˆ preventDefault æ‰èƒ½ drop
            coinSlot.classList.add('drag-over');
        });

        coinSlot.addEventListener('dragleave', () => {
            coinSlot.classList.remove('drag-over');
        });

        coinSlot.addEventListener('drop', (e) => {
            e.preventDefault();
            coinSlot.classList.remove('drag-over');
            
            // å–å¾—é‡‘é¡
            const amount = parseInt(e.dataTransfer.getData('amount'));
            if(amount) {
                currentBudget += amount;
                updateBudgetUI();
                msgBox.textContent = `æŠ•å…¥ $${amount}ï¼Œç›®å‰ç¸½é¡ $${currentBudget}`;
                
                // æŠ•å¹£å‹•ç•«ï¼šè®“æŠ•å¹£å­”é–ƒä¸€ä¸‹
                coinSlot.style.transform = "scale(0.9)";
                setTimeout(()=> coinSlot.style.transform = "scale(1)", 100);
            }
        });

        // é€€å¹£åŠŸèƒ½
        document.getElementById('returnCoinBtn').addEventListener('click', () => {
            if(currentBudget > 0) {
                alert(`é€€é‚„æ‚¨ NT$ ${currentBudget}`);
                currentBudget = 0;
                updateBudgetUI();
                msgBox.textContent = "éŒ¢åŒ…å·²æ¸…ç©º";
            }
        });

        function updateBudgetUI() {
            budgetDisplay.textContent = currentBudget;
        }

        // --- 4. æ‹‰éœ¸æ©Ÿé‚è¼¯ ---
        spinBtn.addEventListener('click', () => {
            // é˜²å‘†ï¼šæ²’éŒ¢ä¸èƒ½ç©
            if (currentBudget < 10) {
                alert("è«‹å…ˆæ‹–æ›³éŒ¢å¹£æŠ•å…¥æ©Ÿå°ï¼(è‡³å°‘ $10)");
                return;
            }
            startSpin();
        });

        document.getElementById('retryBtn').addEventListener('click', startSpin);

        function startSpin() {
            // 1. ä»‹é¢é‡ç½®
            actionArea.style.display = 'none';
            spinBtn.disabled = true;
            msgBox.textContent = "è½‰å‹•ä¸­...";

            // 2. ç¯©é¸è³‡æ–™
            const flavor = document.querySelector('input[name="flavor"]:checked').value;
            const temp = document.querySelector('input[name="temp"]:checked').value;
            
            // é ç®—ç­‰ç´šè½‰æ›é‚è¼¯
            let level = 1;
            if (currentBudget > 1500) level = 4;
            else if (currentBudget > 500) level = 3;
            else if (currentBudget > 150) level = 2;

            let candidates = foodDatabase.filter(food => 
                food.flavor === flavor && 
                food.temp === temp && 
                food.price <= level
            );

            // å¦‚æœéŒ¢å¾ˆå°‘(ä¾‹å¦‚åªæŠ•10å…ƒ)ï¼Œé‚„æ˜¯çµ¦ä»–å¹³åƒ¹é¸å–®
            if (candidates.length === 0) {
                if (currentBudget < 50) {
                     candidates = [{name: "ç™½é£¯+é†¬æ²¹", price: 1}, {name: "ç§‘å­¸éºµ", price: 1}];
                } else {
                     candidates = [{name: "é€™åƒ¹ä½æ‰¾ä¸åˆ°", price: 0}];
                }
            }

            // 3. å»ºæ§‹é•·æ¢åœ– (Reel Construction)
            const TOTAL_ITEMS = 20; // ç¸½æ ¼æ•¸
            let htmlContent = "";
            
            // éš¨æ©Ÿå¡«å……å‰é¢çš„é …ç›®
            for(let i=0; i<TOTAL_ITEMS-1; i++) {
                const r = candidates[Math.floor(Math.random() * candidates.length)];
                htmlContent += `<div class="slot-item">${r.name}</div>`;
            }
            
            // æ±ºå®šæœ€çµ‚è´å®¶
            const winner = candidates[Math.floor(Math.random() * candidates.length)];
            htmlContent += `<div class="slot-item" style="color:#d32f2f;">${winner.name}</div>`;

            // 4. å‹•ç•«æ ¸å¿ƒ (è§£æ±º "åªæœ‰ç¬¬ä¸€æ¬¡æœƒè½‰" çš„å•é¡Œ)
            
            // A. å…ˆç§»é™¤å‹•ç•« classï¼Œä¸¦å¼·åˆ¶æ­¸é›¶
            reelStrip.classList.remove('spin-animation');
            reelStrip.style.transform = 'translateY(0px)';
            reelStrip.innerHTML = `<div class="slot-item">æº–å‚™...</div>`; // æš«æ™‚æ¸…ç©º

            // B. å¼·åˆ¶ç€è¦½å™¨ Reflow (é‡ç¹ª) - é€™æ˜¯é—œéµï¼
            // è®€å– offsetWidth æœƒå¼·è¿«ç€è¦½å™¨è¨ˆç®—ç•¶å‰æ¨£å¼ï¼Œç¢ºä¿ä¸Šé¢çš„ç§»é™¤ class ç”Ÿæ•ˆ
            void reelStrip.offsetWidth; 

            // C. å¡«å…¥çœŸæ­£çš„å…§å®¹
            reelStrip.innerHTML = htmlContent;

            // D. è¨ˆç®—ç›®æ¨™ä½ç½®
            const targetY = -(TOTAL_ITEMS - 1) * ITEM_HEIGHT;

            // E. åŠ ä¸Šå‹•ç•« class ä¸¦ç§»å‹•
            // ä½¿ç”¨ setTimeout ç¢ºä¿ä¸Šé¢çš„ DOM æ“ä½œå·²ç¶“å®Œæˆ
            requestAnimationFrame(() => {
                reelStrip.classList.add('spin-animation');
                reelStrip.style.transform = `translateY(${targetY}px)`;
            });

            // 5. çµæŸè™•ç†
            setTimeout(() => {
                spinBtn.disabled = false;
                msgBox.textContent = `æ¨è–¦ï¼š${winner.name}`;
                actionArea.style.display = 'flex';
                mapLink.href = `http://googleusercontent.com/maps.google.com/search?q=${encodeURIComponent(winner.name)}`;
            }, 3000); // 3ç§’å¾Œåœä¸‹
        }
    </script>
</body>
</html>
